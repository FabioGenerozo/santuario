
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Sistema de Solicitações</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
  <h1>Solicitação de Itens</h1>
  <label>Solicitante: <input id="solicitante" /></label><br />
  <label>Departamento: <input id="departamento" /></label><br />
  <label>Data de Retirada: <input id="dataRetirada" type="date" /></label><br />
  <label>Data de Devolução: <input id="dataDevolucao" type="date" /></label><br />
  <button onclick="salvarSolicitacao()">Salvar Solicitação</button>
  <button onclick="window.location.href='admin.html'">Painel de Administração</button>

  <script>
    const firebaseConfig = {
      databaseURL: "https://patrimonio-santuario-bjp-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const solicitacoesRef = database.ref("solicitacoes");
    const estoqueRef = database.ref("estoque");

    const carrinho = [
      { item: "Cadeira", quantidade: 2 },
      { item: "Mesa", quantidade: 1 }
    ]; // Simulando carrinho

    const salvarSolicitacao = () => {
      const solicitante = document.getElementById("solicitante").value;
      const departamento = document.getElementById("departamento").value;
      const data = new Date().toLocaleString("pt-BR");
      const dataRetirada = document.getElementById("dataRetirada").value;
      const dataDevolucao = document.getElementById("dataDevolucao").value;

      if (!solicitante || !departamento || carrinho.length === 0) {
        alert("Preencha todos os campos e adicione ao menos um item.");
        return;
      }

      solicitacoesRef.once("value", (snapshot) => {
        const total = snapshot.numChildren() + 1;
        const numero = total.toString().padStart(4, "0");

        const solicitacao = {
          numero,
          solicitante,
          departamento,
          data,
          dataRetirada,
          dataDevolucao,
          itens: carrinho
        };

        solicitacoesRef.push(solicitacao);

        carrinho.forEach(({ item, quantidade }) => {
          const itemRef = estoqueRef.child(item);
          itemRef.transaction(current => (current || 0) - quantidade);
        });

        alert("Solicitação registrada com sucesso!");
        location.reload();
      });
    };
  </script>
</body>
</html>
