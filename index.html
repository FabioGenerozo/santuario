<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solicitação de Itens - Estoque</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px #ccc;
    }
    h1, h2 {
      text-align: center;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #4f46e5;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #4338ca;
    }
    #listaSolicitacoes li {
      margin-bottom: 10px;
      padding: 10px;
      background-color: #f9fafb;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      list-style: none;
    }
    #btnLogout {
      background-color: #ef4444;
      margin-bottom: 15px;
    }
  </style>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <div class="container">
    <h1>Solicitação de Itens</h1>

    <div id="userInfoSection">
      <h2>Informe seus dados</h2>
      <form id="userInfoForm">
        <input type="text" id="nomeUsuario" placeholder="Nome do solicitante" required />
        <input type="text" id="departamentoUsuario" placeholder="Departamento" required />
        <button type="submit">Salvar Dados</button>
      </form>
    </div>

    <div id="solicitacaoSection" style="display:none;">
      <button id="btnLogout">Sair / Trocar usuário</button>

      <h2>Solicitar Itens</h2>
      <form id="solicitarForm">
        <input type="text" id="itemSolicitado" placeholder="Item desejado" required />
        <input type="number" id="quantidadeSolicitada" placeholder="Quantidade" required min="1" />
        <button type="submit">Finalizar Solicitação</button>
      </form>
      <p id="mensagemSucesso" style="color: green;"></p>

      <h2>Solicitações Registradas</h2>
      <ul id="listaSolicitacoes"></ul>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      databaseURL: "https://patrimonio-santuario-bjp-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const solicitacoesRef = database.ref("solicitacoes");

    // Elementos
    const userInfoSection = document.getElementById("userInfoSection");
    const userInfoForm = document.getElementById("userInfoForm");
    const nomeUsuarioInput = document.getElementById("nomeUsuario");
    const departamentoUsuarioInput = document.getElementById("departamentoUsuario");

    const solicitacaoSection = document.getElementById("solicitacaoSection");
    const solicitarForm = document.getElementById("solicitarForm");
    const itemSolicitadoInput = document.getElementById("itemSolicitado");
    const quantidadeSolicitadaInput = document.getElementById("quantidadeSolicitada");
    const mensagemSucesso = document.getElementById("mensagemSucesso");
    const listaSolicitacoes = document.getElementById("listaSolicitacoes");
    const btnLogout = document.getElementById("btnLogout");

    // Função para mostrar a seção de solicitação e esconder a de dados do usuário
    function mostrarSolicitacaoSection() {
      userInfoSection.style.display = "none";
      solicitacaoSection.style.display = "block";
    }

    // Função para mostrar a seção de dados do usuário e esconder a de solicitação
    function mostrarUserInfoSection() {
      userInfoSection.style.display = "block";
      solicitacaoSection.style.display = "none";
    }

    // Verifica se já tem dados no localStorage para pular a etapa do usuário
    window.addEventListener("load", () => {
      const nome = localStorage.getItem("nomeUsuario");
      const departamento = localStorage.getItem("departamentoUsuario");
      if (nome && departamento) {
        mostrarSolicitacaoSection();
      } else {
        mostrarUserInfoSection();
      }
    });

    // Salvar dados do usuário no localStorage
    userInfoForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const nome = nomeUsuarioInput.value.trim();
      const departamento = departamentoUsuarioInput.value.trim();

      if (!nome || !departamento) {
        alert("Por favor, preencha nome e departamento.");
        return;
      }

      localStorage.setItem("nomeUsuario", nome);
      localStorage.setItem("departamentoUsuario", departamento);

      mostrarSolicitacaoSection();
    });

    // Logout para apagar os dados e voltar para tela de usuário
    btnLogout.addEventListener("click", () => {
      localStorage.removeItem("nomeUsuario");
      localStorage.removeItem("departamentoUsuario");
      mostrarUserInfoSection();
      // limpa formulário de solicitação
      solicitarForm.reset();
      mensagemSucesso.textContent = "";
      listaSolicitacoes.innerHTML = "";
    });

    // Enviar solicitação para Firebase
    solicitarForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const nome = localStorage.getItem("nomeUsuario");
      const departamento = localStorage.getItem("departamentoUsuario");
      const item = itemSolicitadoInput.value.trim();
      const quantidade = parseInt(quantidadeSolicitadaInput.value);

      if (!item || !quantidade || quantidade < 1) {
        alert("Por favor, preencha o item e a quantidade corretamente.");
        return;
      }

      const novaSolicitacao = {
        solicitante: nome,
        departamento: departamento,
        item: item,
        quantidade: quantidade,
        data: new Date().toLocaleString()
      };

      solicitacoesRef.push(novaSolicitacao);

      solicitarForm.reset();
      mensagemSucesso.textContent = "Solicitação registrada com sucesso!";

      setTimeout(() => {
        mensagemSucesso.textContent = "";
      }, 4000);
    });

    // Exibir lista de solicitações em tempo real
    solicitacoesRef.on("value", (snapshot) => {
      listaSolicitacoes.innerHTML = "";

      snapshot.forEach((childSnapshot) => {
        const s = childSnapshot.val();

        const li = document.createElement("li");
        li.textContent = `${s.solicitante} (${s.departamento}) - ${s.item} (${s.quantidade}) - ${s.data}`;

        listaSolicitacoes.appendChild(li);
      });
    });
  </script>
</body>
</html>
